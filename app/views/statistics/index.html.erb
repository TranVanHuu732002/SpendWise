<div class="min-h-screen bg-gray-100 py-10 flex items-center justify-center">
  <div class="w-full max-w-7xl bg-white shadow-xl rounded-2xl p-8">
    <h1 class="text-3xl font-bold mb-10 text-center text-blue-700">📊 Thống kê chi tiêu</h1>
    <div class="flex flex-col md:flex-row gap-8 items-start">
      <!-- Left: Bảng thống kê -->
      <div class="md:w-1/2 w-full">
        <div class="mb-8" data-controller="statistics-table"
          data-statistics-table-category='<%= raw @category_stats.to_json %>'
          data-statistics-table-month='<%= raw @monthly_stats.to_json %>'
          data-statistics-table-year='<%= raw @yearly_stats.to_json %>'>
          <div class="flex flex-row items-center justify-between gap-4 mb-4">
            <div class="flex flex-col">
              <div class="flex flex-row items-center gap-2">
                <label for="tableTypeSelect" class="text-base font-semibold text-blue-700">Chọn loại bảng</label>
                <select id="tableTypeSelect" data-action="change->statistics-table#changeType" class="px-4 py-2 rounded-lg border border-blue-400 bg-white text-blue-700 font-semibold shadow focus:outline-none focus:ring-2 focus:ring-blue-300 transition">
                  <option value="categories">Theo danh mục</option>
                  <option value="monthly">Theo tháng</option>
                  <option value="yearly">Theo năm</option>
                </select>
              </div>
            </div>
            <!-- Export Button -->
            <div class="flex justify-end mt-4">
              <form id="exportForm" action="<%= statistics_path(format: :csv) %>" method="get">
                <input type="hidden" id="exportType" name="type" value="categories" data-statistics-table-target="exportType">
                <button type="submit" class="px-4 py-2 bg-blue-500 text-white rounded-lg shadow hover:bg-blue-600 transition">
                  Xuất báo cáo
                </button>
              </form>
            </div>
          </div>
          <table id="statisticsTable" class="w-full border rounded-lg overflow-hidden mb-4">
            <thead class="bg-blue-100">
              <tr id="tableHeader">
                <th class="py-2 px-4 border font-semibold text-gray-700">Danh mục</th>
                <th class="py-2 px-4 border font-semibold text-gray-700">Số tiền</th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <% @category_stats.each do |category, amount| %>
                <tr class="hover:bg-gray-50">
                  <td class="py-2 px-4 border text-center"><%= category %></td>
                  <td class="py-2 px-4 border text-right text-green-600 font-bold"><%= number_to_currency(amount, unit: "₫", precision: 0) %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
      <!-- Right: Biểu đồ -->
      <div class="md:w-1/2 w-full flex flex-col items-center">
        <div class="w-full flex flex-col items-center" data-controller="statistics-chart"
          data-statistics-chart-labels='<%= raw @monthly_stats.keys.to_json %>' 
          data-statistics-chart-data='<%= raw @monthly_stats.values.to_json %>' 
          data-statistics-chart-year-labels='<%= raw @yearly_stats.keys.to_json %>'
          data-statistics-chart-year-data='<%= raw @yearly_stats.values.to_json %>'
          data-statistics-chart-type="bar">
          <div class="mb-4 w-full flex flex-col items-center">
            <label for="chartTypeSelect" class="mb-2 text-base font-semibold text-blue-700">Chọn loại biểu đồ</label>
            <select id="chartTypeSelect" data-statistics-chart-target="select" data-action="change->statistics-chart#changeType" class="px-4 py-2 rounded-lg border border-blue-400 bg-white text-blue-700 font-semibold shadow focus:outline-none focus:ring-2 focus:ring-blue-300 transition">
              <option value="month">Biểu đồ theo tháng</option>
              <option value="year">Biểu đồ theo năm</option>
            </select>
          </div>
          <div class="bg-white rounded-xl shadow-lg p-6 w-full flex justify-center">
            <canvas 
              id="statisticsChart"
              data-statistics-chart-target="canvas"
              width="400" height="400">
            </canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<% Rails.logger.info "Monthly stats keys: #{raw @monthly_stats.keys.to_json}" %>
<% Rails.logger.info "Monthly stats values: #{raw @monthly_stats.values.to_json}" %>
<% Rails.logger.info "Yearly stats keys: #{raw @yearly_stats.keys.to_json}" %>
<% Rails.logger.info "Yearly stats values: #{raw @yearly_stats.values.to_json}" %>
